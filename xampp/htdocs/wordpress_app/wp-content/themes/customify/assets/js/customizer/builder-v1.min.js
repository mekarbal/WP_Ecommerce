var CustomizeBuilder_V1;!function(r){var l=r(document),c=wp.customize||null,F=Customify_Layout_Builder.is_rtl;CustomizeBuilder_V1=function(n,s){var e={id:s,controlId:"",cols:12,cellHeight:45,items:[],container:null,ready:!1,devices:{desktop:"Desktop",mobile:"Mobile/Tablet"},activePanel:"desktop",panels:{},activeRow:"main",draggingItem:null,getTemplate:_.memoize(function(){var o=this,a={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e,t,i){return _.isUndefined(t)&&(t="tmpl-customize-control-"+o.type),!_.isUndefined(i)&&_.isString(i)?a.variable=i:a.variable="data",_.template(r("#"+t).html(),null,a)(e)}}),drag_drop:function(){var n=this;r(".customify--device-panel",n.container).each(function(){var i=r(this),o=i.data("device"),a=[];n.panels[o]={},r(".customify--cb-items",i).each(function(e){var t,i=r(this).attr("data-id")||"";t=i?"_sid_"+o+"-"+i:"_sid_"+o+e,r(this).attr("id",t),a[e]="#"+t}),r(".grid-stack",i).each(function(){var e=r(this).attr("data-id")||"";n.panels[o][e]=r(this),r(this).droppable({out:function(e,t){},over:function(e,t){},drop:function(e,t){var i=r(this);n.gridster(i,t,e),n.save()}})});var e=r("#_sid_mobile-sidebar",i),t=e.attr("id")||!1;r(".customify-available-items .grid-stack-item",i).draggable({revert:"invalid",connectToSortable:!!t&&"#"+t,start:function(e,t){r("body").addClass("builder-item-moving"),r(".customify--cb-items",i).css("z-index",""),t.helper.parent().css("z-index",9999)},stop:function(e,t){r("body").removeClass("builder-item-moving"),r(".customify--cb-items",i).css("z-index",""),t.helper.parent().css("z-index","")}}),0<e.length&&(e.sortable({revert:!0,change:function(e,t){n.save()},receive:function(e,t){r(this).find(".grid-stack-item").removeAttr("style").attr("data-gs-width",1),n.save()}}),n.panels[o].sidebar=e),r(".customify-available-items .grid-stack-item",i).resizable({handles:"w, e",stop:function(e,t){n.setGridWidth(t.element.parent(),t),n.save()}})})},sortGrid:function(e){r(".grid-stack-item",e).each(function(){var e=r(this),t=e.attr("data-gs-x")||0;t=parseInt(t);var i=e.next();if(0<i.length){var o=i.attr("data-gs-x")||0;(o=parseInt(o))<t&&e.insertAfter(i)}})},getX:function(e){var t=e.attr("data-gs-x")||0;return parseInt(t)},getW:function(e,t){var i;return _.isUndefined(t)&&(t=!1),i=t?e.attr("data-df-width")||1:e.attr("data-gs-width")||1,parseInt(i)},gridGetItemInfo:function(e,t,i){var o,a=this.getX(e),n=this.getW(e),s=0,r=0,l=!1;for(o=a-1;0<=o&&!l;)0===t[o]?s++:l=!0,o--;for(l=!1,o=a+n;o<this.cols&&!l;)0===t[o]?r++:l=!0,o++;return{flag:t,x:a,w:n,item:e,before:s,after:r,id:e.attr("data-id")||"",wrapper:i}},updateItemsPositions:function(e){for(var t=this.cols,i=0;i<=t;i++)"object"!=typeof e[i]&&"function"!=typeof e[i]||e[i].attr("data-gs-x",i)},gridster:function(e,t,i){var o,v=[],m=this,p=this.cols,h=function(e){for(var t=e.x,i=e.w,o=e.el,a=t;a<t+i;a++)v[a]=a===t?o:1},l=function(e){for(var t=e.x,i=e.w,o=(e.el,t);o<t+i;o++)v[o]=0},w=function(e,t){for(var i=0,o=e;o<p;o++)if(0===v[o])i++;else if(t)return i;return i},b=function(e,t){var i=0;void 0===t&&(t=!1);for(var o=e;0<=o;o--)if(0===v[o])i++;else if(t)return i;return i},x=function(e){return 0===v[e]},y=function(e,t){for(var i=e;i<e+t;){if(0!==v[i])return!1;i++}return!0},I=function(e){if(e<0)return{x:-1,w:1};var t,i,o,a=-1;if(v[e]<=1)for(t=e,o=!1;0<=t&&!o;)1!==v[t]&&0!==v[t]&&(a=t,o=!0),t--;else a=e;for(t=a+1,i=a;1===v[t];)i++,t++;return{x:a,w:i+1-a}},z=function(e){var t,i,o,a=-1;if(v[e]<p)for(t=e,o=!1;t<p&&!o;)1!==v[t]&&0!==v[t]&&(a=t,o=!0),t++;else a=e;for(t=a+1,i=a;1===v[t];)i++,t++;return{x:a,w:i+1-a}},C=function(e,t){var i=v.slice(),o=b(e);if(0===o)return t;var a=I(e),n=0<=a.x?a.x+a.w-1:e,s=t;s=o<t?o:t;for(var r=0,l=0,c=n;l<=s&&0<=c;)0===v[c]&&(l++,r=c),c--;var d=[],f=0;for(c=r;c<=n;c++)(v[c]=0)!==i[c]&&(d[f]=i[c],f++);for(f=0,c=r;c<=n;c++)void 0!==d[f]?v[c]=d[f]:v[c]=0,f++;return t-s},P=function(e,t){var i=v.slice(),o=w(e);if(0===o)return t;var a=I(e),n=0<=a.x?a.x:e,s=t;s=t<=o?t:o;for(var r=e,l=0,c=n;l<s&&c<p;)0===v[c]&&(l++,r=c),c++;var d=[],f=0;for(c=n;c<=r;c++)(v[c]=0)!==i[c]&&(d[f]=i[c],f++);for(f=d.length-1,c=r;n<=c;c--)void 0!==d[f]?v[c]=d[f]:v[c]=0,f--;return t-s},D=function(){m.updateItemsPositions(v)},c=function(e,t){var i,o,a,n,d=e.x,s=e.w,r=function(){for(var e=0,t=0;t<p;t++)0===v[t]&&e++;return e}();if(r<=0)return!1;if(_.isUndefined(t)&&(t=!1),!t){if(x(d)){if(y(d,n=s))return h(e),e.el.attr("data-gs-x",d),e.el.attr("data-gs-width",n),!0;for((i=s<=(o=w(d,!0))+(a=b(d-1,!0))&&s-o<=a?d-(s-o):d-a)<0&&(i=0),console.log("_re",o),console.log("_le",a),console.log("__x",i);1<=n;){if(y(i,n))return console.log({x:i,w:n}),e.x=i,e.w=n,h(e),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",n),!0;n--}}if(1===v[d]){var l=I(d);if(0<=l.x&&d>l.x+Math.floor(l.w/2)&&d>l.x&&(i=l.x+l.w,o=w(i,!0),console.log("__re",o),console.log("__re_X",i),s<=o))return h({el:e.el,x:i,w:s}),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",s),!0}}console.log("--------------------------------------------------------");!function(e,t){var i,o,a,n,s=0,r=!1;if(console.log("insert at x",t),console.log("insert node",e),x(t)){if(console.log("empty_at_X",t),i=I(t),o=z(t),-1<i.x){if(console.log("found_item_left",i),(s=w(i.x))>=e.w)if(y(t,e.w))console.log("found",e),d=t,r=!0;else if(e.ox>t)for(a=i.x+i.w,n=(n=b(a))<=e.w?e.w-n:e.w,P(a+1,n),s=w(a),console.log("loop_start_i",a),r=!1;a>i.x+i.w&&!r;)y(a,e.w)&&(console.log("found_in_loop__i",a),d=a,r=!0),a--;if(!r&&e.ox<t){console.log("try_move_items_to_left",i),a=i.x+i.w-1,n=b(i.x),console.log("el",n),n>e.w&&(n=e.w),n-=2,C(i.x,n),console.log("try_move_items_to_left_flag",v),console.log("el2",n),a-=s=w(a),o=z(t);var l=i.x+i.w;for(-1<o.x&&(l=o.x),console.log("loop_start 2_i",a);a<l&&!r;)y(a,e.w)&&(console.log("found_in_loop__@__i",a),d=a,r=!0),a++}r||(d=i.x+i.w,e.w=s,e.x=d,console.log("resize_new_w",s),console.log("resize_new_x",d))}else if(-1<o.x){console.log("found_item_right",o),o=z(t),s=w(t,!1),console.log("move_all_item_to Right");var c=s>=e.w?e.w:s;for(P(t,c),a=o.x,console.log("loop_start Right",a);0<=a&&!r;)y(a,e.w)&&(d=a,e.x=d,r=!0,console.log("found_in_while_r",a)),a--;r||(d=t,e.w=s,e.x=d,console.log("resize_r_new_w",s),console.log("resize_r_new_x",d))}}else if(console.log("x is not empty"),i=I(t),e.ox<i.x)if(C(t,e.w),console.log("Move All items to left"),x(t))d=t;else{for(;!x(t)&&t<=m.cols-1;)t++;d=t}else if(P(t,e.w),console.log("Move All items to right"),x(t))d=t;else{for(;!x(t)&&0<=t;)t--;d=t}d>m.cols&&(d=m.cols-1),e.x=d,console.log("new node x",d)}(e,_.clone(d));var c,f=d,u=!1,g=0;for(d+s>m.cols-1&&(g=b(d,!0),console.log("le",g),0<g&&console.log("move_Left",d+s-m.cols-1)),D(),g=0;1<=s;){if(s<=r){if(y(d,s))return console.log("",{x:d,w:s}),e.w=s,h(e),e.el.attr("data-gs-x",d),e.el.attr("data-gs-width",s),!0;for(g=b(d,!(u=!1)),f=d-g,console.log("newX",f),c=f;c<p&&!u;){if(y(c,s))return console.log("Insert in While",{x:c,w:s}),e.w=s,h({el:e.el,x:c,w:s}),e.el.attr("data-gs-x",c),e.el.attr("data-gs-width",s),u=!0;c++}}s--}for(s=e.w,u=!1;1<=s;){for(c=0;c<p&&!u;){if(y(c,s))return console.log("Insert in While 2",{x:c,w:s}),h({el:e.el,x:c,w:s}),e.el.attr("data-gs-x",c),e.el.attr("data-gs-width",s),u=!0;c++}s--}return console.log("Insert END While",{x:c,w:s}),!1};o=(v=(m=this).getFlag(e)).slice();var a=e.offset();m.draggingItem=t.draggable;var n,s,r,d,f=e.width(),u=f/m.cols,g=0,k=t.offset;s=m.getW(t.draggable,!1),n=m.getW(t.draggable,!0),r=t.draggable.width(),console.log("DROP ITEM WIDTH",n),console.log("DROP ITEM cw WIDTH",s);var A=m.getX(t.draggable);F&&l({el:t.draggable,x:A,w:n});var S,T=0,M=0,G=!1;if(t.draggable.parent().is(e)?(d=!0,console.log("Item in this row"),n=s):(d=!1,console.log("Not in this row"),n<s&&(n=s)),F?(T=Math.round((a.left+f+10-i.clientX)/u),(M=Math.round((a.left+f-(k.left+r+10))/u))<0&&(M=0)):(T=Math.round((i.clientX-a.left)/u),(M=Math.round((k.left-a.left-10)/u))<0&&(M=0)),T>m.cols&&(T=m.cols),S=g=M,F)if(x(S))g=M,G=!0;else for(;S<m.cols&&!G;)x(S)?G=!0:S++;else if(x(g))g=M,G=!0;else{for(;g<=T&&!G;)x(g)?G=!0:g++;T<g&&(g=T)}if(G||(g=d?M:T),g<0&&(g=0),g+n>=m.cols){for(G=!0,S=g;S+n>m.cols&&G;)x(S)?S--:(S++,G=!1),console.log("loop_i",S);console.log("Find new _i, w: "+n,S),g=S}delete G,console.log("DROP Cursor",T),console.log("DROP row x cacl",g),console.log("DROP item w",n);var R={el:t.draggable,x:g,w:n,ox:A,ow:s};R.x<=0&&(R.x=0);var W=!1;d?(R.x=parseInt(t.draggable.attr("data-gs-x")||0),R.w=parseInt(t.draggable.attr("data-gs-width")||1),console.log("swap node",R),function(e,t){e.x;var i=e.w;l(e),console.log("Swap newX",t),console.log("Before Swap FLAG",v);var o=I(t),a=0;if(-1<o.x&&(a=o.x+o.w),y(t,i))return h({el:e.el,x:t,w:i});if(0<a&&y(a,i)&&a<=t){var n=z(t);if(-1<n.x&&e.w+t>=n.x)for(var s=_.clone(t);a<s;){if(y(s,i))return h({el:e.el,x:s,w:i});s--}if(t+i>m.cols){var r=m.cols-i;if(y(r,i))return h({el:e.el,x:r,w:i})}return h({el:e.el,x:a,w:i})}e.x=t,c(e,!0)}(R,g),W=!0):(W=c(R),console.log("Insert node")),W?(t.draggable.removeClass("item-from-list"),e.append(t.draggable),t.draggable.removeAttr("style"),console.log("DID Flag: ",v),m.draggingItem=null):(t.draggable.removeAttr("style"),console.log("Can not insert"),v=o),D(),m.updateAllGrids()},updateAllGrids:function(){var i=this;_.each(i.panels[i.activePanel],function(e,t){i.updateGridFlag(e)})},setGridWidth:function(e,t){var i,o,a=this,n=t.element,s=e.width(),r=t.size.width,l=t.originalSize.width,c=Math.ceil(s/a.cols)-1;o=F?(i=t.originalPosition.left>t.position.left,l!==r):(i=t.originalPosition.left>t.position.left,t.originalPosition.left<t.position.left);var d,f,u,g=t.originalElement.attr("data-gs-width")||1,v=t.originalElement.attr("data-gs-x")||0;g=parseInt(g),v=parseInt(v);var m,p=a.getFlag(e),h=a.gridGetItemInfo(t.originalElement,p,e);if(i)return F?(f=Math.floor((t.position.left-1)/c),(d=(f=a.cols-f)-v-g)>h.after&&(d=h.after),u=g+d,n.attr("data-gs-x",v).removeAttr("style")):((d=v-(f=Math.floor((t.position.left-1)/c)))>h.before&&(d=h.before),f=v-d,u=g+d,n.attr("data-gs-x",f).removeAttr("style")),n.attr("data-gs-width",u).removeAttr("style"),void a.updateGridFlag(e);if(o)return F?t.originalPosition.left!==t.position.left?(f=Math.floor((t.position.left-1)/c),g<(d=g+v-(f=a.cols-f))&&(d=0),u=g-d,(f=v)<=0&&(f=0),console.log("diffRight_RTL_COL_New __left")):(f=Math.ceil((t.position.left+t.size.width-11)/c),(d=v-(f=a.cols-f))>h.before&&(d=h.before),f=v-d,u=g+d):((u=g-(d=(f=Math.round((t.position.left-1)/c))-v))<=0&&(u=1,d=0),f=v+d),n.attr("data-gs-x",f).removeAttr("style"),n.attr("data-gs-width",u).removeAttr("style"),void a.updateGridFlag(e);var w,_=h.x;r<t.originalSize.width?((w=Math.round((t.position.left+t.size.width-11)/c))<=_&&(w=_+1),m=h.w-(_+h.w-w)):(w=Math.ceil((t.position.left+t.size.width-11)/c),m=h.w+(w-(_+h.w)),h.x+m>h.x+h.w+h.after&&(m=h.w+h.after)),m<=0&&(m=1),n.attr("data-gs-width",m).removeAttr("style"),a.updateGridFlag(e)},getFlag:function(e){var t,i=e.data("gridRowFlag")||[];if(_.isEmpty(i)){for(t=0;t<this.cols;t++)i[t]=0;e.data("gridRowFlag",i)}return i},updateGridFlag:function(e){var o,a=this,n=[];for(o=0;o<a.cols;o++)n[o]=0;return r(".grid-stack-item",e).each(function(e){r(this).removeAttr("style");var t=a.getX(r(this)),i=a.getW(r(this));for(o=t;o<t+i;o++)n[o]=o===t?r(this):1}),e.data("gridRowFlag",n),a.updateItemsPositions(n),a.sortGrid(e),n},addNewWidget:function(e,t){var i=this,o=i.container.find(".customify--device-panel.customify--panel-"+i.activePanel),a=t;_.isObject(a)||(a=o.find(".customify--cb-items").first());var n=e;n.draggable({revert:"invalid",appendTo:o,scroll:!1,zIndex:99999,handle:".grid-stack-item-content",start:function(e,t){r("body").addClass("builder-item-moving"),r(".customify--cb-items",o).css("z-index",""),t.helper.parent().css("z-index",9999)},stop:function(e,t){r("body").removeClass("builder-item-moving"),r(".customify--cb-items",o).css("z-index",""),i.save()},drag:function(e,t){}}).resizable({handles:"w, e",start:function(e,t){t.originalElement.css({right:"auto",left:t.position.left})},stop:function(e,t){i.setGridWidth(t.element.parent(),t),i.save()}}),a.append(n),i.updateGridFlag(a)},addPanel:function(e){var t=this.getTemplate(),i="tmpl-customify--cb-panel";if(0!=r("#"+i).length)return _.isObject(n.rows)||(n.rows={}),'<div class="customify--device-panel customify-vertical-panel customify--panel-'+e+'" data-device="'+e+'">'+t({device:e,id:n.id,rows:n.rows},i)+"</div>"},addDevicePanels:function(){var o=this;_.each(o.devices,function(e,t){var i=o.addPanel(t);r(".customify--cb-devices-switcher",o.container).append('<a href="#" class="switch-to switch-to-'+t+'" data-device="'+t+'">'+e+"</a>"),r(".customify--cb-body",o.container).append(i)}),r("#customify-upsell-tmpl").length&&r(r("#customify-upsell-tmpl").html()).insertAfter(r(".customify--cb-devices-switcher",o.container))},addItem:function(e){var t=this.getTemplate(),i="tmpl-customify--cb-item";if(0!=r("#"+i).length){var o=t(e,i);return r(o)}},addAvailableItems:function(){var s=this;_.each(s.devices,function(e,a){var n=r('<div class="customify-available-items" data-device="'+a+'"></div>');r(".customify--panel-"+a,s.container).append(n),_.each(s.items,function(e){var t=!0;if(!_.isUndefined(e.devices)&&!_.isEmpty(e.devices))if(_.isString(e.devices))e.devices!=a&&(t=!1);else{var i=!1;_.each(e.devices,function(e){a==e&&(i=!0)}),i||(t=!1)}if(t){var o=s.addItem(e);n.append(o)}})})},switchToDevice:function(e,t){var i=this;1<_.size(i.devices)?(r(".customify--cb-devices-switcher a",i.container).removeClass("customify--tab-active"),r(".customify--cb-devices-switcher .switch-to-"+e,i.container).addClass("customify--tab-active"),r(".customify--device-panel",i.container).addClass("customify--panel-hide"),r(".customify--device-panel.customify--panel-"+e,i.container).removeClass("customify--panel-hide"),i.activePanel=e):r(".customify--cb-devices-switcher a",i.container).addClass("customify--tab-active"),(_.isUndefined(t)||t)&&("desktop"==e?r("#customize-footer-actions .preview-desktop").trigger("click"):r("#customize-footer-actions .preview-mobile").trigger("click"))},addExistingRowsItems:function(){var s=this,t=c.control(s.controlId).params.value;_.isObject(t)||(t={}),_.each(s.panels,function(a,n){var e={};_.isObject(t[n])&&(e=t[n]),_.each(e,function(e,o){_.isUndefined(e)||_.each(e,function(e,t){var i=r('.customify-available-items[data-device="'+n+'"] .grid-stack-item[data-id="'+e.id+'"]').first();i.attr("data-gs-width",e.width),i.attr("data-gs-x",e.x),i.removeClass("item-from-list"),s.addNewWidget(i,a[o])})})}),s.ready=!0},focus:function(){this.container.on("click",".customify--cb-item-setting, .customify--cb-item-name, .item-tooltip",function(e){e.preventDefault();var t=r(this).data("section")||"",i=r(this).attr("data-control")||"",o=!1;i&&(_.isUndefined(c.control(i))||(c.control(i).focus(),o=!0)),o||t&&!_.isUndefined(c.section(t))&&(c.section(t).focus(),o=!0)}),this.container.on("click",".customify--cb-row-settings",function(e){e.preventDefault();var t=r(this).attr("data-id")||"",i=n.id+"_"+t;_.isUndefined(c.section(i))||c.section(i).focus()})},remove:function(){var o=this;l.on("click",".customify--device-panel .customify--cb-item-remove",function(e){e.preventDefault();var t=r(this).closest(".grid-stack-item"),i=t.closest(".customify--device-panel");t.attr("data-gs-width",1),t.attr("data-gs-x",0),t.removeAttr("style"),r(".customify-available-items",i).append(t),o.updateAllGrids(),o.save()})},encodeValue:function(e){return encodeURI(JSON.stringify(e))},decodeValue:function(e){return JSON.parse(decodeURI(e))},save:function(){var a=this;if(a.ready){var n={};_.each(a.panels,function(e,o){n[o]={},_.each(e,function(e,t){var i=_.map(r(" > .grid-stack-item",e),function(e){return e=r(e),{x:a.getX(e),y:1,width:a.getW(e),height:1,id:e.data("id")||""}});n[o][t]=i})}),c.control(a.controlId).setting.set(a.encodeValue(n))}},showPanel:function(){var t=this;this.container.removeClass("customify--builder--hide").addClass("customify--builder-show"),setTimeout(function(){var e=t.container.height();r("#customize-preview").addClass("cb--preview-panel-show").css({bottom:e-1,"margin-top":"0px"})},100)},hidePanel:function(){this.container.removeClass("customify--builder-show"),r("#customize-preview").removeClass("cb--preview-panel-show").removeAttr("style")},togglePanel:function(){var t=this;c.state("expandedPanel").bind(function(e){c.panel(n.panel).expanded()?(l.trigger("customify_panel_builder_open",[n.panel]),console.log("open-builder:",n.panel),top._current_builder_panel=s,t.showPanel()):t.hidePanel()}),t.container.on("click",".customify--panel-close",function(e){e.preventDefault(),t.container.toggleClass("customify--builder--hide"),t.container.hasClass("customify--builder--hide")?r("#customize-preview").removeClass("cb--preview-panel-show"):r("#customize-preview").addClass("cb--preview-panel-show")})},panelLayoutCSS:function(){var e=r("#customize-controls").width();c.state("paneVisible").get()||(e=0),F?this.container.find(".customify--cb-inner").css({"margin-right":e}):this.container.find(".customify--cb-inner").css({"margin-left":e})},init:function(e,t,i){var o=this,a=o.getTemplate()(n,"tmpl-customify--builder-panel");o.container=r(a),r("body .wp-full-overlay").append(o.container),o.controlId=e,o.items=t,o.devices=i,n.section&&c.section(n.section).container.addClass("customify--hide"),o.addDevicePanels(),o.switchToDevice(o.activePanel),o.addAvailableItems(),o.switchToDevice(o.activePanel),o.drag_drop(),o.focus(),o.remove(),o.addExistingRowsItems(),c.panel(n.panel).expanded()?(console.log("open-builder:",n.panel),o.showPanel()):o.hidePanel(),c.previewedDevice.bind(function(e){"desktop"===e?o.switchToDevice("desktop",!1):o.switchToDevice("mobile",!1)}),o.togglePanel(),c.state("paneVisible").get()&&o.panelLayoutCSS(),c.state("paneVisible").bind(function(){o.panelLayoutCSS()}),r(window).resize(_.throttle(function(){o.panelLayoutCSS()},100)),o.container.on("click",".customify--cb-devices-switcher a.switch-to",function(e){e.preventDefault();var t=r(this).data("device");o.switchToDevice(t)}),l.trigger("customify_builder_panel_loaded",[s,o])}};return e.init(n.control_id,n.items,n.devices),e}}(jQuery);